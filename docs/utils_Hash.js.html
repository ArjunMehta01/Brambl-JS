<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/Hash.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/Hash.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>("use strict")
// Dependencies
const Base58 = require("base-58");
const blake = require("blake2");
const fs = require("fs");

// Based on JCS spec
// https://tools.ietf.org/html/draft-rundgren-json-canonicalization-scheme-17
JSON.canonify = require("canonicalize");

/**
 * standard FastCryptographicHash in Bifrost
 * @returns Initialized hash function 
 */
function hashFunc() {
    return blake.createHash("blake2b", { digestLength: 32 })
}

/**
 * Create hash digest and encode
 *
 * @param {object} hash Hash object 
 * @param {string} [encoding] Desired output encoding. May be one of `hex`, `base64`, or `base58`. If none provided a `Buffer` is returned
 * @returns Blake2b-256 hash digest
 */
function digestAndEncode(hash, encoding) {
    hash.end()
    switch (encoding) {
        case "hex":
        case "base64":
            return hash.read().toString(encoding)

        case "base58":
            return Base58.encode(hash.read())

        default:
            return hash.read()
    }
}

/**
 * @class Static only class to hash an input message and produce an output that matches the output of Bifrost FastCrytographicHash
 */
class Hash {
    /**
     * Calculates the Blake2b-256 hash of an arbitrary input. This function will apply JSON canonicalization to the given message.
     * Further information regarding JON canonicalization may be found at {@link https://github.com/cyberphone/json-canonicalization}
     *
     * @param {any} message input message to create the hash digest of
     * @param {string} encoding output encoding
     * @returns Blake2b-256 hash digest
     */
    static any(message, encoding) {
        const msg = Buffer.from(JSON.canonify(message))
        const hash = hashFunc().update(msg)
        return digestAndEncode(hash, encoding)
    }

    /**
     * Calculates the Blake2b-256 of a string input
     *
     * @param {string} message input string message to create the hash digest of
     * @param {string} encoding output encoding
     * @returns Blake2b-256 hash digest
     */
    static string(message, encoding) {
        const msg = Buffer.from(message)
        const hash = hashFunc().update(msg)
        return digestAndEncode(hash, encoding)
    }

    /**
     * Reads the file from disk and calculates the Blake2b-256
     *
     * @param {string} filePath path to the input file
     * @param {string} encoding output encoding
     * @returns Blake2b-256 hash digest
     */
    static file(filePath, encoding) {
        return new Promise((resolve, reject) =>
            fs
                .createReadStream(filePath)
                .on("error", reject)
                .pipe(hashFunc())
                .once("finish", function () {
                    resolve(digestAndEncode(this, encoding));
                })
        );
    };
}

module.exports = Hash</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Hash.html">Hash</a></li><li><a href="KeyManager.html">KeyManager</a></li><li><a href="Loki.html">Loki</a></li><li><a href="Requests.html">Requests</a></li></ul><h3>Global</h3><ul><li><a href="global.html#create">create</a></li><li><a href="global.html#decrypt">decrypt</a></li><li><a href="global.html#deriveKey">deriveKey</a></li><li><a href="global.html#digestAndEncode">digestAndEncode</a></li><li><a href="global.html#dump">dump</a></li><li><a href="global.html#encrypt">encrypt</a></li><li><a href="global.html#generateKeystoreFilename">generateKeystoreFilename</a></li><li><a href="global.html#getMAC">getMAC</a></li><li><a href="global.html#hashFunc">hashFunc</a></li><li><a href="global.html#isCipherAvailable">isCipherAvailable</a></li><li><a href="global.html#LokiRequest">LokiRequest</a></li><li><a href="global.html#marshal">marshal</a></li><li><a href="global.html#recover">recover</a></li><li><a href="global.html#str2buf">str2buf</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Apr 09 2020 00:50:19 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
